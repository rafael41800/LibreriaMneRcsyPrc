% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/05_Rf_Modelado_Distribucion_Especies_Function.R
\name{Rf_SDM_multiple_species}
\alias{Rf_SDM_multiple_species}
\title{Modelado de Distribución de Especies Múltiples con Random Forest
/ Multiple Species Distribution Modeling with Random Forest}
\usage{
Rf_SDM_multiple_species(
  Resultados_List,
  Variables,
  Variable_Presencia = "Presence",
  Registros_Minimos = 10,
  Stack_Raster_Reproyectado = NULL,
  Ruta_Almacenamiento = NULL,
  N_Tree = 100,
  Set_Seed = NULL,
  Cross_V_Particiones = 5,
  Tune_M_Try = TRUE
)
}
\arguments{
\item{Resultados_List}{Lista nombrada donde cada elemento corresponde a una
especie y contiene un data.frame con columnas de presencia/ausencia y
variables predictoras. Debe incluir la columna especificada en Variable_Presencia
(factor) y las variables especificadas en Variables.
/ Named list where each element corresponds to a species and contains a
data.frame with presence/absence columns and predictor variables. Must
include the column specified in Variable_Presencia (factor) and variables
specified in Variables.}

\item{Variables}{Vector de caracteres con los nombres de las variables
predictoras a utilizar en el modelado. Estas columnas deben estar presentes
en los data.frames de Resultados_List. La función automáticamente incluye
la columna especificada en Variable_Presencia.
/ Character vector with names of predictor variables to use in modeling.
These columns must be present in the data.frames of Resultados_List.
The function automatically includes the column specified in Variable_Presencia.}

\item{Variable_Presencia}{Nombre de la columna que contiene los datos de
presencia/ausencia (0/1). Por defecto es "Presence". Debe ser un factor con
niveles 0 (ausencia) y 1 (presencia).
/ Name of the column containing presence/absence data (0/1). Default is
"Presence". Must be a factor with levels 0 (absence) and 1 (presence).}

\item{Registros_Minimos}{Número mínimo de registros (presencia + ausencia)
requeridos para modelar una especie. Por defecto es 10.
/ Minimum number of records (presence + absence) required to model a species.
Default is 10.}

\item{Stack_Raster_Reproyectado}{Objeto raster stack (de terra o raster)
con las variables predictoras proyectadas espacialmente. Si se proporciona,
se generan mapas de predicción de probabilidad.
/ Raster stack object (from terra or raster) with spatially projected
predictor variables. If provided, probability prediction maps are generated.}

\item{Ruta_Almacenamiento}{Ruta de directorio donde guardar los resultados
(modelos, datos de validación, gráficos, raster). Si es NULL, no se guardan
archivos.
/ Directory path to save results (models, validation data, plots, raster).
If NULL, no files are saved.}

\item{N_Tree}{Número de árboles en cada modelo Random Forest. Por defecto 100.
/ Number of trees in each Random Forest model. Default 100.}

\item{Set_Seed}{Semilla para reproducibilidad. Si es NULL, no se fija semilla.
/ Seed for reproducibility. If NULL, no seed is set.}

\item{Cross_V_Particiones}{Número de folds para validación cruzada. Si es 1 o menos,
no se realiza validación cruzada. Por defecto 5.
/ Number of folds for cross-validation. If 1 or less, no cross-validation is
performed. Default 5.}

\item{Tune_M_Try}{Lógico. Si TRUE, se ajusta automáticamente el parámetro
mtry (número de variables muestreadas en cada split). Si FALSE, se usa mtry=2.
/ Logical. If TRUE, automatically tunes the mtry parameter (number of variables
sampled at each split). If FALSE, uses mtry=2.}
}
\value{
Una lista nombrada (por especie) con los siguientes componentes para cada
modelo exitoso:
\itemize{
\item modelo: Objeto Random Forest entrenado.
\item importance: Importancia de variables.
\item Resumen_Modelo_Temporal_CrossValidation: Resumen de métricas de validación cruzada (si aplica).
\item Exactitud_Datos_Entrenamiento, Exactitud_Datos_Prueba: Precisión en entrenamiento y prueba.
\item sensitivity, specificity: Sensibilidad y especificidad.
\item precision, recall, f1_score: Métricas de clasificación.
\item kappa: Coeficiente Kappa.
\item auc: Área bajo la curva ROC (si aplica).
\item Matriz_Conf_Datos_Entrenamiento, Matriz_Conf_Datos_Prueba, Matriz_Confusion_Datos_Validacion: Matrices de confusión.
\item roc_curve: Objeto curva ROC (si aplica).
\item mtry_used, ntree_used: Parámetros usados.
\item variable_presencia_used: Nombre de la variable de presencia utilizada.
\item raster_prediction: Raster de predicción (si se proporcionó stack).
}
/
A named list (by species) with the following components for each successful model:
\itemize{
\item modelo: Trained Random Forest object.
\item importance: Variable importance.
\item Resumen_Modelo_Temporal_CrossValidation: Cross-validation metrics summary (if applicable).
\item Exactitud_Datos_Entrenamiento, Exactitud_Datos_Prueba: Accuracy on training and test sets.
\item sensitivity, specificity: Sensitivity and specificity.
\item precision, recall, f1_score: Classification metrics.
\item kappa: Kappa coefficient.
\item auc: Area under ROC curve (if applicable).
\item Matriz_Conf_Datos_Entrenamiento, Matriz_Conf_Datos_Prueba, Matriz_Confusion_Datos_Validacion: Confusion matrices.
\item roc_curve: ROC curve object (if applicable).
\item mtry_used, ntree_used: Parameters used.
\item variable_presencia_used: Name of the presence variable used.
\item raster_prediction: Prediction raster (if stack provided).
}
}
\description{
Ejecuta modelos Random Forest para múltiples especies a partir de datos de
presencia/ausencia, incluyendo validación cruzada, evaluación de métricas y
predicción espacial. Genera modelos individuales por especie cuando se cumplen
los requisitos mínimos de registros.
/
Executes Random Forest models for multiple species from presence/absence data,
including cross-validation, metric evaluation, and spatial prediction.
Generates individual models per species when minimum record requirements are met.
}
\details{
La función sigue este flujo por cada especie:
\enumerate{
\item Filtrado: Solo especies con al menos Registros_Minimos.
\item Preprocesamiento: Limpieza de NA, factorización de Variable_Presencia.
\item Partición: 10\% validación final, del resto 70\% entrenamiento y 30\% prueba.
\item Ajuste mtry: Si Tune_M_Try=TRUE, optimiza con tuneRF.
\item Validación cruzada: Si Cross_V_Particiones>1, calcula métricas por fold.
\item Modelado: Entrena Random Forest con parámetros óptimos.
\item Evaluación: Calcula múltiples métricas en entrenamiento, prueba y validación.
\item Predicción espacial: Si hay stack raster, genera mapa de probabilidad.
\item Almacenamiento: Si hay ruta, guarda modelos, gráficos y rasters.
/
The function follows this workflow per species:
\item Filtering: Only species with at least Registros_Minimos.
\item Preprocessing: NA cleaning, Variable_Presencia factorization.
\item Splitting: 10\% final validation, from remainder 70\% training and 30\% test.
\item mtry tuning: If Tune_M_Try=TRUE, optimizes with tuneRF.
\item Cross-validation: If Cross_V_Particiones>1, calculates metrics per fold.
\item Modeling: Trains Random Forest with optimal parameters.
\item Evaluation: Calculates multiple metrics on training, test, and validation.
\item Spatial prediction: If raster stack exists, generates probability map.
\item Storage: If path provided, saves models, plots, and rasters.
}
}
\note{
\itemize{
\item Se requieren al menos 2 clases (presencia y ausencia) para modelar.
\item La validación cruzada solo se realiza si hay suficientes datos.
\item Las gráficas de importancia de variables y curvas ROC se guardan automáticamente.
\item La función maneja errores internamente y omite especies problemáticas.
\item Se asume que Variable_Presencia es factor con niveles 0 (ausencia) y 1 (presencia).
\item La columna Variable_Presencia se incluye automáticamente en los datos de modelado.
/
\item At least 2 classes (presence and absence) are required for modeling.
\item Cross-validation is only performed if enough data exists.
\item Variable importance plots and ROC curves are saved automatically.
\item The function handles errors internally and skips problematic species.
\item Assumes Variable_Presencia column is factor with levels 0 (absence) and 1 (presence).
\item The Variable_Presencia column is automatically included in the modeling data.
}
}
\section{Advertencias/Warnings}{

\itemize{
\item Con muchas especies o variables, el tiempo de ejecución puede ser alto.
\item La memoria requerida depende del tamaño del raster y número de especies.
\item La calidad del modelo depende críticamente de la calidad de los datos de entrada.
\item El umbral de Registros_Minimos debe ajustarse según la realidad de los datos.
/
\item With many species or variables, execution time may be high.
\item Required memory depends on raster size and number of species.
\item Model quality critically depends on input data quality.
\item Registros_Minimos threshold should be adjusted based on data reality.
}
}

\examples{
\dontrun{
# Cargar datos de ejemplo / Load example data
data(presence_absence_data) # Lista con datos por especie / List with data per species
data(predictor_stack) # Stack raster con variables / Raster stack with variables

# Ejecutar modelos con nombre por defecto / Run models with default name
modelos <- Rf_SDM_multiple_species(
Resultados_List = presence_absence_data,
Variables = c("temp_mean", "precip", "elevation", "soil_type"),
Registros_Minimos = 15,
Stack_Raster_Reproyectado = predictor_stack,
Ruta_Almacenamiento = "./resultados_sdm",
N_Tree = 500,
Set_Seed = 123,
Cross_V_Particiones = 5,
Tune_M_Try = TRUE
)

# Ejecutar modelos con nombre personalizado / Run models with custom name
modelos2 <- Rf_SDM_multiple_species(
Resultados_List = presence_absence_data,
Variables = c("temp_mean", "precip", "elevation", "soil_type"),
Variable_Presencia = "Ocurrencia",
Registros_Minimos = 15,
Stack_Raster_Reproyectado = predictor_stack,
Ruta_Almacenamiento = "./resultados_sdm2",
N_Tree = 500,
Set_Seed = 123,
Cross_V_Particiones = 5,
Tune_M_Try = TRUE
)

# Explorar resultados / Explore results
names(modelos)
modelos[["Quercus_robur"]]$Exactitud_Datos_Prueba
modelos[["Quercus_robur"]]$auc
modelos[["Quercus_robur"]]$variable_presencia_used

# Visualizar importancia de variables / Visualize variable importance
barplot(sort(modelos[["Pinus_sylvestris"]]$importance[, "MeanDecreaseGini"],
decreasing = TRUE))
}

}
\seealso{
\itemize{
\item \code{\link[randomForest]{randomForest}} para detalles del algoritmo.
\item \code{\link[caret]{confusionMatrix}} para métricas de clasificación.
\item \code{\link[pROC]{roc}} para curvas ROC.
\item \code{\link[terra]{predict}} para predicción espacial.
/
\item \code{\link[randomForest]{randomForest}} for algorithm details.
\item \code{\link[caret]{confusionMatrix}} for classification metrics.
\item \code{\link[pROC]{roc}} for ROC curves.
\item \code{\link[terra]{predict}} for spatial prediction.
}
}
\concept{funciones_modelado_especies, funciones_random_forest,
funciones_distribucion_especies /
species_modeling_functions, random_forest_functions,
species_distribution_functions}
\keyword{SDM,}
\keyword{aprendizaje}
\keyword{automático,}
\keyword{cross-validation,}
\keyword{cruzada,}
\keyword{de}
\keyword{distribución}
\keyword{distribution}
\keyword{espacial,}
\keyword{especies,}
\keyword{evaluación}
\keyword{evaluation,}
\keyword{forest,}
\keyword{learning,}
\keyword{machine}
\keyword{model}
\keyword{modelado}
\keyword{modeling,}
\keyword{modelos,}
\keyword{predicción}
\keyword{prediction}
\keyword{random}
\keyword{spatial}
\keyword{species}
\keyword{validación}
