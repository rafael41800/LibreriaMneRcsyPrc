% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/03_Presencias_Sf_Sin_Na_function.R
\name{Presences_Sf_No_Na_List_Df}
\alias{Presences_Sf_No_Na_List_Df}
\title{Presencias desde un sf sin entradas NA's / Presence Data from sf without NA Entries}
\usage{
Presences_Sf_No_Na_List_Df(
  Data_Sf,
  raster_referencia_reproyectado,
  Especie_Valida = "especievalida"
)
}
\arguments{
\item{Data_Sf}{Objeto \code{sf} con datos de presencia de especies. Debe contener
geometrias puntuales y la columna especificada en \code{Especie_Valida}.
/ \code{sf} object with species presence data. Must contain point geometries
and the column specified in \code{Especie_Valida}.}

\item{raster_referencia_reproyectado}{Objeto \code{SpatRaster} proyectado con
las variables ambientales. Debe estar en el mismo sistema de coordenadas
que \code{Data_Sf} para una extraccion correcta.
/ Projected \code{SpatRaster} object with environmental variables. Must be in
the same coordinate system as \code{Data_Sf} for correct extraction.}

\item{Especie_Valida}{Nombre de la columna que contiene los identificadores
de especie. Puede ser nombre cientifico, codigo de especie u otro
identificador unico.
/ Name of the column containing species identifiers. Can be scientific
name, species code, or other unique identifier.}
}
\value{
Una lista con los siguientes elementos:
\itemize{
\item Un dataframe por cada especie unica encontrada en \code{Data_Sf}
\item Cada dataframe contiene:
\itemize{
\item Coordenadas (\code{longitud}, \code{latitud}) extraidas de las geometrias
\item Todos los atributos originales del objeto \code{sf}
\item Valores extraidos de todas las capas del raster (\code{layer1}, \code{layer2}, ...)
\item Variable \code{Presencia} con valor constante \code{1} para todos los registros
}
\item Todos los dataframes han sido limpiados eliminando:
\itemize{
\item Columnas que son completamente NA (sin valores utiles)
\item Filas con cualquier valor NA en las columnas restantes
}
\item Los nombres de la lista corresponden a las especies unicas
/
A list with the following elements:
\item One dataframe per unique species found in \code{Data_Sf}
\item Each dataframe contains:
\itemize{
\item Coordinates (\code{longitud}, \code{latitud}) extracted from geometries
\item All original attributes from the \code{sf} object
\item Values extracted from all raster layers (\code{layer1}, \code{layer2}, ...)
\item \code{Presencia} variable with constant value \code{1} for all records
}
\item All dataframes have been cleaned by removing:
\itemize{
\item Columns that are completely NA (no useful values)
\item Rows with any NA values in the remaining columns
}
\item List names correspond to unique species
}
}
\description{
Extrae y procesa datos de presencia de especies desde un objeto \code{sf},
combinandolos con valores de variables ambientales de un raster y
eliminando todos los registros incompletos (con valores NA). La funcion
genera dataframes limpios y listos para analisis de distribucion de especies.
/
Extracts and processes species presence data from an \code{sf} object,
combining them with environmental variable values from a raster and
removing all incomplete records (with NA values). The function produces
clean dataframes ready for species distribution analysis.
}
\details{
La funcion ejecuta el siguiente flujo de procesamiento para cada especie:
\enumerate{
\item \strong{Filtrado por especie}: Separa los registros para cada especie unica
\item \strong{Extraccion de coordenadas}: Convierte geometrias sf a coordenadas X,Y
\item \strong{Extraccion de valores raster}: Obtiene valores de todas las bandas del
raster en cada ubicacion puntual
\item \strong{Combinacion de datos}: Crea un dataframe integrando coordenadas,
atributos originales y valores raster
\item \strong{Limpieza de columnas}: Elimina columnas que contienen solo valores NA
\item \strong{Limpieza de filas}: Elimina filas que contienen cualquier valor NA
en las columnas restantes
\item \strong{Adicion de variable respuesta}: Agrega columna \code{Presencia = 1} para
modelado de distribucion de especies
}

La limpieza en dos etapas (columnas luego filas) optimiza la retencion de
datos utiles y garantiza datasets completos para analisis posteriores.
/
The function executes the following processing flow for each species:
\enumerate{
\item \strong{Species filtering}: Separates records for each unique species
\item \strong{Coordinate extraction}: Converts sf geometries to X,Y coordinates
\item \strong{Raster value extraction}: Obtains values from all raster bands at
each point location
\item \strong{Data combination}: Creates a dataframe integrating coordinates,
original attributes, and raster values
\item \strong{Column cleaning}: Removes columns containing only NA values
\item \strong{Row cleaning}: Removes rows containing any NA values in the
remaining columns
\item \strong{Response variable addition}: Adds \code{Presencia = 1} column for
species distribution modeling
}

The two-stage cleaning (columns then rows) optimizes retention of useful
data and ensures complete datasets for subsequent analysis.
}
\note{
\itemize{
\item La funcion requiere que \code{Data_Sf} y \code{raster_referencia_reproyectado}
esten en el mismo sistema de coordenadas de referencia (CRS). Si no lo
estan, los valores extraidos del raster pueden ser incorrectos.
\item Las geometrias deben ser puntos (\code{POINT}). Otros tipos de geometria
pueden causar errores o resultados inesperados.
\item El orden de limpieza es importante: primero se eliminan columnas
completamente NA, luego filas con NA. Esto maximiza la retencion de
datos validos.
\item La columna \code{Especie_Valida} debe existir en \code{Data_Sf} y contener
valores no nulos para todas las observaciones.
\item La variable \code{Presencia} siempre tiene valor 1, ya que todos los
registros son presencias confirmadas.
/
\item The function requires that \code{Data_Sf} and \code{raster_referencia_reproyectado}
are in the same coordinate reference system (CRS). If they are not,
extracted raster values may be incorrect.
\item Geometries must be points (\code{POINT}). Other geometry types may cause
errors or unexpected results.
\item The cleaning order is important: first completely NA columns are removed,
then rows with NA. This maximizes retention of valid data.
\item The \code{Especie_Valida} column must exist in \code{Data_Sf} and contain
non-null values for all observations.
\item The \code{Presencia} variable always has value 1, since all records are
confirmed presences.
}
}
\section{Advertencias/Warnings}{

\itemize{
\item Si el raster y el objeto sf tienen diferentes CRS, la funcion no fallara
pero los valores extraidos pueden no corresponder a las ubicaciones reales.
\item Especies con muy pocos registros pueden resultar en dataframes vacios
despues de la limpieza de NA.
\item Columnas con nombres duplicados entre el objeto sf y el raster pueden
causar conflictos de nombres en el dataframe resultante.
\item El proceso de extraccion de valores raster puede ser lento con muchos
puntos (miles o mas).
/
\item If the raster and sf object have different CRS, the function will not fail
but extracted values may not correspond to actual locations.
\item Species with very few records may result in empty dataframes after
NA cleaning.
\item Columns with duplicate names between the sf object and raster may cause
naming conflicts in the resulting dataframe.
\item The raster value extraction process can be slow with many points
(thousands or more).
}
}

\examples{
\dontrun{
# Ejemplo 1: Procesar datos de mamiferos de Oaxaca
# Example 1: Process mammal data from Oaxaca
library(sf)
library(dplyr)
library(terra)

# Cargar datos de presencia (formato sf con puntos)
# Load presence data (sf format with points)
Mamiferos_Oax_Sf <- st_read("datos/mamiferos.csv") \%>\%
  filter(estadomapa == "OAXACA") \%>\%
  st_as_sf(coords = c("longitud", "latitud"), crs = 4326)

# Cargar y proyectar raster de variables ambientales
# Load and project environmental variables raster
raster_c1 <- rast("datos/temperatura.tif")
raster_c2 <- rast("datos/precipitacion.tif")
raster_tif <- c(raster_c1, raster_c2)
raster_proyectado <- terra::project(raster_tif, "EPSG:4326")

# Verificar que CRS coinciden
# Verify that CRS match
print(st_crs(Mamiferos_Oax_Sf))
print(crs(raster_proyectado))

# Procesar datos sin NA
# Process data without NA
resultados <- Presencias_Sf_Sin_Na(
  Data_Sf = Mamiferos_Oax_Sf,
  raster_referencia_reproyectado = raster_proyectado,
  Especie_Valida = "especie"
)

# Ver resultados
# Check results
print(paste("Numero de especies procesadas:", length(resultados)))

if(length(resultados) > 0) {
  # Ver primera especie
  # Check first species
  print(paste("Primera especie:", names(resultados)[1]))
  print(paste("Numero de registros:", nrow(resultados[[1]])))
  print(head(resultados[[1]]))

  # Resumen de todas las especies
  # Summary of all species
  resumen <- data.frame(
    Especie = names(resultados),
    Registros = sapply(resultados, nrow)
  )
  print(resumen)
}

# Ejemplo 2: Usar diferente nombre de columna de especie
# Example 2: Use different species column name
resultados2 <- Presencias_Sf_Sin_Na(
  Data_Sf = Mamiferos_Oax_Sf,
  raster_referencia_reproyectado = raster_proyectado,
  Especie_Valida = "nombre_cientifico"
)

# Ejemplo 3: Datos con diferentes tipos de variables
# Example 3: Data with different variable types
raster_multi <- rast(system.file("ex/elev.tif", package="terra"))
datos_ejemplo <- st_as_sf(
  data.frame(
    especie = rep(c("A", "B"), each = 10),
    longitud = runif(20, 5.5, 6.5),
    latitud = runif(20, 49, 50)
  ),
  coords = c("longitud", "latitud"), crs = 4326
)

resultados3 <- Presencias_Sf_Sin_Na(
  Data_Sf = datos_ejemplo,
  raster_referencia_reproyectado = raster_multi,
  Especie_Valida = "especie"
)
}

}
\seealso{
\itemize{
\item \code{\link[terra]{extract}} para extraer valores raster en puntos /
\code{\link[terra]{extract}} for extracting raster values at points
\item \code{\link[sf]{st_coordinates}} para extraer coordenadas de objetos sf /
\code{\link[sf]{st_coordinates}} for extracting coordinates from sf objects
\item \code{\link[stats]{complete.cases}} para identificar filas completas sin NA /
\code{\link[stats]{complete.cases}} for identifying complete rows without NA
\item \code{\link[dplyr]{filter}} para filtrar dataframes basados en condiciones /
\code{\link[dplyr]{filter}} for filtering dataframes based on conditions
}
}
\concept{funciones_SDM, funciones_limpieza_datos, funciones_espaciales /
SDM_functions, data_cleaning_functions, spatial_functions}
\keyword{GIS}
\keyword{GIS,}
\keyword{SDM,}
\keyword{cleaning,}
\keyword{data}
\keyword{datos,}
\keyword{de}
\keyword{extraccion}
\keyword{extraction,}
\keyword{limpieza}
\keyword{presence-absence,}
\keyword{presences,}
\keyword{presencia-ausencia,}
\keyword{presencias,}
\keyword{raster}
\keyword{raster,}
\keyword{valores}
\keyword{value}
